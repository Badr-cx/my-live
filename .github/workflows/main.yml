name: ğŸ“º Facebook Live Streamer (Text Overlay)
on:
  workflow_dispatch:
    inputs:
      m3u8_url:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØµØ¯Ø± M3U8 Source'
        required: true
      fb_rtmp:
        description: 'Ù…ÙØªØ§Ø­ Ø§Ù„Ø¨Ø« Facebook RTMPS'
        required: true
      overlay_text:
        description: 'Ø§Ù„Ù†Øµ Ø§Ù„Ù„ÙŠ Ø¨ØºÙŠØªÙŠ ÙŠØ¨Ø§Ù† Ù„ØªØ­Øª'
        default: 'Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± - Live Stream'
        required: false

jobs:
  stream:
    runs-on: ubuntu-latest
    steps:
      - name: Install FFmpeg & Fonts
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg fonts-dejavu-core

      - name: ğŸš€ Streaming Loop (Center Bottom Text)
        run: |
          # Ø³ÙƒØ±ÙŠØ¨Øª ÙƒÙŠØ¹Ø§ÙˆØ¯ Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆÙƒÙŠØ­Ø· Ø§Ù„Ù†Øµ Ù„ØªØ­Øª ÙÙŠ Ø§Ù„ÙˆØ³Ø·
          while true; do
            ffmpeg -re -i "${{ github.event.inputs.m3u8_url }}" \
            -vf "drawtext=text='${{ github.event.inputs.overlay_text }}':x=(w-text_w)/2:y=h-th-50:fontsize=36:fontcolor=white:box=1:boxcolor=black@0.6:boxborderw=10" \
            -c:v libx264 -preset veryfast -b:v 3000k -maxrate 3000k -bufsize 6000k \
            -pix_fmt yuv420p -g 60 -c:a aac -ar 44100 -b:a 128k \
            -f flv "${{ github.event.inputs.fb_rtmp }}" \
            || echo "Reconnecting in 5 seconds..."
            sleep 5
          done
